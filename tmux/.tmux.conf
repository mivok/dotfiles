# Reset all settings
source ~/.tmux/tmux.reset.conf

# Reload with Prefix + R
bind R source-file ~/.tmux.conf \; display "Config reloaded"

# C-a is better than C-b
set-option -g prefix C-a

# Mouse support is nice for copy/paste and scrolling
set-option -g mouse on

# put the tmux title in the xterm title bar
set-option -g set-titles on

# Make the first window index 1 (because 1 is on the left on the keyboard)
set-option -g base-index 1

# Explicitly set copy mode
set-window-option -g mode-keys vi

# Scrollback using Shift-PgUp and Shift-PgDn
# This needs iTerm2 configured to send:
#   \e[5;2~ for Shift-Pgup and
#   \e[6;2~ for Shift-PgDn
bind-key -T copy-mode-vi S-PageUp send-keys -X page-up
bind-key -T copy-mode-vi S-PageDown send-keys -X page-down
bind-key -T copy-mode S-PageUp send-keys -X page-up
bind-key -T copy-mode S-PageDown send-keys -X page-down
bind-key -n S-PageUp copy-mode -eu
bind-key -n S-PageDown display-message "At bottom"

# Make mouse wheel scrollback work more like iterm default (1 line at a time)
bind -T copy-mode WheelUpPane      select-pane \; send-keys -X -N 1 scroll-up
bind -T copy-mode WheelDownPane    select-pane \; send-keys -X -N 1 scroll-down
bind -T copy-mode-vi WheelUpPane   select-pane \; send-keys -X -N 1 scroll-up
bind -T copy-mode-vi WheelDownPane select-pane \; send-keys -X -N 1 scroll-down

# Some more things to make mouse copy mode easier
bind-key DoubleClick1Pane  select-pane \; copy-mode \; send-keys -X select-word
bind-key TripleClick1Pane  select-pane \; copy-mode \; send-keys -X select-line

# Better window split keys
bind-key | split-window -h
bind-key - split-window

# Prompt for the name of a new window
bind-key c command-prompt -p "Window name:" "new-window -n '%%'"

# Load profiles
bind-key l command-prompt -p "Load profile:" "source-file ~/.tmux/scripts/%%"
bind-key t source-file ~/.tmux/scripts/4up

# Detatch should accept C-d
bind-key C-d detach-client

# Theme
set -g @themepack 'powerline/double/cyan'

# Plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'jimeh/tmux-themepack'

# Set path for run-shell commands (needed for tpm and homebrew installed tmux)
set-environment -g PATH "/usr/local/bin:/bin:/usr/bin"

# Auto-install TPM
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && \
   ~/.tmux/plugins/tpm/bin/install_plugins'"

# Run tpm
run -b '~/.tmux/plugins/tpm/tpm'
